{% extends 'base.html' %}

{% load marktags %}

{% block title %}Login{% endblock %}

{% block head_scripts %}
<script>
    // This runs in the iframe
    var key = 'user_session';

    function getLocalStorageKey(c_name) {
        return localStorage.getItem(c_name);
    }

    function setLocalStorageKey(c_name, value) {
        return localStorage.setItem(c_name, value);
    }

    function getCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
    }

    var value = getCookie('user_session');
    setLocalStorageKey('user_session', value);
    console.log('user session: ');
    console.log(getLocalStorageKey(key));

    // This is nice and works!
    window.top.postMessage({'user_session': value}, '*');  // * means cross origin

</script>
{% endblock %}

{% block content %}



{% if not user_session %}
<h2>Login</h2>
<form method="post">
  {% csrf_token %}
  {{ form.as_p }}
  <button type="submit">Login</button>
</form>
{% else %}
You user session is: {{ user_session }}. COOKIE - {% cookie 'user_session' %}
<br>
<a href="{% url 'sso_logout' %}">logout</a>
{% endif%}

{% endblock %}
